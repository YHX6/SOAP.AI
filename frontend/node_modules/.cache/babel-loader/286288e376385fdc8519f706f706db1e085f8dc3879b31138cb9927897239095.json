{"ast":null,"code":"var _jsxFileName = \"/Users/yhx67/Projects/ZH/erisedstory-speech-therapy/frontend/src/pages/Stroypage.jsx\",\n  _s = $RefreshSig$();\nimport \"../assets/css/storypage.css\";\nimport StoryImg from \"../assets/imgs/home_bg.png\";\nimport DecisionImg from \"../assets/imgs/sample_fear.png\";\nimport ConversationImg from \"../assets/imgs/conversation.jpg\";\nimport ConversationAvator from \"../assets/imgs/con-bot.png\";\nimport AudioIcon from \"../assets/icons/audio-fill.svg\";\nimport AudioCurrentIcon from \"../assets/icons/audio.svg\";\nimport Dinasour from \"../assets/icons/dinasour.png\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport axios from \"axios\";\nimport { conversationRouter, storyRouter } from \"../config/routeConfig\";\nimport { storyActions } from \"../redux/StorySlice\";\nimport { useEffect, useState } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction Storypage() {\n  _s();\n  const dispatch = useDispatch();\n  // const navigate = useNavigate();\n\n  // states\n  const scriptplay_id = useSelector(state => state.story.scriptplay_id);\n  const story = useSelector(state => state.story.story);\n  const atagonist = useSelector(state => state.story.atagonist);\n  const pages = useSelector(state => state.story.pages);\n  const nextTask = useSelector(state => state.story.nextTask);\n  const storyPlayData = useSelector(state => state.story.storyPlayData);\n  // the page that is currently showing\n  // const [currentPage, setCurrentPage] = useState(0);\n  const [selectedChoice, setSelectedChoice] = useState(-1);\n  const setDecisionChoice = n => {\n    // add logic here to prevent following code if it is history page\n\n    setSelectedChoice(n);\n  };\n  const [messages, setMessages] = useState([]);\n  const [userMsg, setUserMsg] = useState(\"\");\n\n  /* \n  nextTask: \n      ASK_STORY: ask for a story description\n      ASK_DECISION_MAKING: ask for decision making and three options\n      ASK_CONVERSATION: ask for character\n      CONTINUE_DECISION_MAKING: ask for story description after options\n      END_CONVERSATION: ask for story description after conversation\n  */\n\n  const continueStory = () => {\n    // console.log(nextTask);\n    // 1.\n    if (nextTask === \"ASK_STORY\") {\n      axios.post(storyRouter, {\n        script_name: story,\n        task: nextTask,\n        prompt: getStoryPrompt(),\n        order: pages + 1,\n        scriptplay_id: scriptplay_id,\n        summary: \"N/A\"\n      }).then(resp => {\n        // You can change next task to conversation/decision/story here\n        // dispatch(storyActions.addStoryPlayData({data:resp.data, nextTask:\"ASK_DECISION_MAKING\"}));\n        dispatch(storyActions.addStoryPlayData({\n          data: resp.data,\n          nextTask: \"ASK_CONVERSATION\"\n        }));\n      }).catch(e => alert(e));\n      // 2.\n    } else if (nextTask === \"ASK_DECISION_MAKING\") {\n      axios.post(storyRouter, {\n        script_name: story,\n        task: nextTask,\n        prompt: getStoryPrompt(),\n        order: pages + 1,\n        scriptplay_id: scriptplay_id,\n        summary: \"N/A\"\n      }).then(resp => {\n        dispatch(storyActions.addStoryPlayData({\n          data: resp.data,\n          nextTask: \"CONTINUE_DECISION_MAKING\"\n        }));\n      }).catch(e => alert(e));\n      // 3.\n    } else if (nextTask === \"CONTINUE_DECISION_MAKING\") {\n      // check if choice is maked first\n      if (selectedChoice === -1) {\n        alert(\"Let's make a choice first!\");\n        return;\n      }\n      // send request\n      axios.post(storyRouter, {\n        script_name: story,\n        task: nextTask,\n        prompt: getStoryPrompt(),\n        order: pages + 1,\n        scriptplay_id: scriptplay_id,\n        summary: \"N/A\",\n        choice: storyPlayData[pages - 1][`option_${selectedChoice}`]\n      }).then(resp => {\n        setSelectedChoice(-1);\n        // You can change next task to conversation/decision/story here\n        dispatch(storyActions.addStoryPlayData({\n          data: resp.data,\n          nextTask: \"ASK_CONVERSATION\"\n        }));\n      }).catch(e => alert(e));\n      // 4.\n    } else if (nextTask === \"ASK_CONVERSATION\") {\n      axios.post(storyRouter, {\n        script_name: story,\n        task: nextTask,\n        prompt: getStoryPrompt(),\n        order: pages + 1,\n        scriptplay_id: scriptplay_id,\n        summary: \"N/A\"\n      }).then(resp => {\n        dispatch(storyActions.addStoryPlayData({\n          data: resp.data,\n          nextTask: \"END_CONVERSATION\"\n        }));\n        setMessages([{\n          role: \"assistant\",\n          content: resp.data.first_sentence\n        }]);\n      }).catch(e => alert(e));\n      // 5.\n    } else if (nextTask === \"END_CONVERSATION\") {\n      axios.post(storyRouter, {\n        script_name: story,\n        task: nextTask,\n        prompt: getStoryPrompt(),\n        order: pages + 1,\n        scriptplay_id: scriptplay_id,\n        summary: \"N/A\",\n        messages: messages,\n        character_name: atagonist\n      }).then(resp => {\n        // clean messages\n        setMessages([]);\n        dispatch(storyActions.addStoryPlayData({\n          data: resp.data,\n          nextTask: \"ASK_DECISION_MAKING\"\n        }));\n      }).catch(e => alert(e));\n    }\n  };\n\n  // combine all the data into a story prompt\n  const getStoryPrompt = () => {\n    let res = \"\";\n    for (let i = 0; i < pages; i++) {\n      if (storyPlayData[i].type === \"story-description\") {\n        res += storyPlayData[i].story;\n      }\n    }\n    return res;\n  };\n\n  // 1.if show story\n  const renderPageStory = dataShown => {\n    /* \n    data format:{\n      \"story\": \"In the enchanting world of magic, you step into the shoes of Harry Potter, the Boy Who Lived. Born on July 31, 1980, he hails from the non-magical Dursley family but is destined for greatness. An orphan raised by his cruel aunt and uncle, Harry discovered his extraordinary wizarding abilities on his 11th birthday when he received an acceptance letter from Hogwarts School of Witchcraft and Wizardry. With a lightning bolt scar on his forehead, he survived the dark wizard, Lord Voldemort, as a baby. As you embark on your journey, you'll learn about spells, potions, and the profound destiny that awaits you at Hogwarts. \",\n      \"type\": \"story-description\",\n      \"order\": 1,\n      \"timestamp\": \"2024-02-24T20:52:59.070248\"\n    }\n    */\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"story-page-left story-page-left-1\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"story-page-img img-box boder-1\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: StoryImg,\n            alt: \"a sample img\",\n            className: \"story-page-img box-img\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 168,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"story-page-right story-page-right-1\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"right-type1-body boder-1 bg-color-pink-1\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            className: \"story-decoration-img\",\n            src: Dinasour,\n            alt: \"a cute dinasour\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-size-2-5 right-type1-title font-bold\",\n            children: \"Story\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-size-2 right-type1-content scrobar-1\",\n            children: dataShown.story\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"page-right-btns\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn-steps font-size-2\",\n            onClick: continueStory,\n            children: \"Next\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true);\n  };\n\n  // 2.if show decision making\n  const renderPageDecision = dataShown => {\n    /* \n    data format:{\n      question:\n      option_1:\n      option_2:\n      option_3: \n      \"type\": \"decision-making\",\n      \"order\": 1,\n      \"timestamp\": \"2024-02-24T20:52:59.070248\"\n       //below only shows in history data\n      choice: <OPTION CONTENT>\n    }\n    */\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"story-page-left story-page-left-2\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"story-page-img img-box boder-1\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: DecisionImg,\n            alt: \"a sample img\",\n            className: \"story-page-img box-img\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"story-page-right story-page-right-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"right-type2-body boder-1 bg-color-green-1\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"right-type2-qs font-size-2-5 font-bold\",\n            children: \"Decision Making\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"right-type2-question font-size-2 scrobar-1\",\n            children: dataShown.question\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"right-type2-choices scrobar-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: `btn-choices font-size-2 ${selectedChoice === 1 ? \"btn-choices-selected\" : \"\"}`,\n              onClick: () => setDecisionChoice(1),\n              children: dataShown.option_1\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: `btn-choices font-size-2 ${selectedChoice === 2 ? \"btn-choices-selected\" : \"\"}`,\n              onClick: () => setDecisionChoice(2),\n              children: dataShown.option_2\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 221,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: `btn-choices font-size-2 ${selectedChoice === 3 ? \"btn-choices-selected\" : \"\"}`,\n              onClick: () => setDecisionChoice(3),\n              children: dataShown.option_3\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 225,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"page-right-btns\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn-steps font-size-1-5\",\n            onClick: continueStory,\n            children: \"Next\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true);\n  };\n\n  // 3.if show conversation\n  const renderPageConversation = dataShown => {\n    /* \n    data format:{\n      character_name:\n      character_description:\n      first_sentence: \n      \"type\": \"conversation\",\n      \"order\": 1,\n      \"timestamp\": \"2024-02-24T20:52:59.070248\",\n       //below only shows in history data\n      messages [{role:assistant, content:\"\"},{role:user, content:\"\"]\n    }\n    */\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"story-page-left story-page-left-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"story-page-img img-box boder-1\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: ConversationImg,\n            alt: \"a sample img\",\n            className: \"story-page-img box-img\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"left-type-3-msg\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"type-3-msg-avatar \",\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: ConversationAvator,\n              alt: \"a chat bot\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ch-name font-size-1\",\n              children: dataShown.character_name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"type-3-msg-body bubble bubble-bottom-left\",\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"scrobar-1\",\n              children: messages.length > 0 ? messages[messages.length - 1].content : \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 268,\n              columnNumber: 28\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"story-page-right story-page-right-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"right-type3-body boder-1 bg-color-blue-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-size-2-5 right-type1-title font-bold\",\n            children: \"Talk\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"font-size-2 right-type1-content scrobar-1\",\n            type: \"text\",\n            value: userMsg,\n            onChange: e => setUserMsg(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"right-type3-audio\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: chat,\n              children: /*#__PURE__*/_jsxDEV(\"img\", {\n                src: AudioIcon,\n                alt: \"click button for audio input\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 280,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 279,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"page-right-btns\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn-steps font-size-2\",\n            onClick: continueStory,\n            children: \"Next\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true);\n  };\n  const renderPage = () => {\n    let dataShown = storyPlayData[storyPlayData.length - 1]; // replace last page with currentPage\n    if (dataShown.type === \"story-description\") {\n      return renderPageStory(dataShown);\n    } else if (dataShown.type === \"decision-making\") {\n      return renderPageDecision(dataShown);\n    } else if (dataShown.type === \"conversation\") {\n      return renderPageConversation(dataShown);\n    }\n  };\n\n  // user input and send to chat\n  const chat = () => {\n    let newMessages = messages;\n    newMessages.push({\n      role: \"user\",\n      content: userMsg\n    });\n    console.log(newMessages);\n    axios.post(conversationRouter, {\n      username: atagonist,\n      prompt: getStoryPrompt(),\n      character_name: storyPlayData[pages - 1].character_name,\n      character_description: storyPlayData[pages - 1].character_description,\n      messages: newMessages\n    }).then(resp => {\n      // console.log(resp.data);\n      setUserMsg(\"\");\n      setMessages([...messages, {\n        role: \"assistant\",\n        content: resp.data\n      }]);\n    }).catch(e => alert(e));\n    // setMessages([...messages, {role:\"user\", userMsg}])   \n  };\n  // useEffect(() => {\n  //     const asyncUseEffect = () => {\n  //         console.log(12)\n  //         if(messages.length > 0 && messages[messages.length -1].role === \"user\"){\n  //             axios.post(conversationRouter, {\n  //                 chat_background: storyPlayData[pages -1].chat_background,\n  //                 prompt: getStoryPrompt(),\n  //                 character_name:storyPlayData[pages -1].character_name,\n  //                 character_description:storyPlayData[pages -1].character_description,\n  //                 messages: messages,\n  //             })\n  //             .then((resp) => {\n  //                 console.log(resp.data);\n  //                 setUserMsg(\"\");\n  //             })\n  //             .catch((e) => alert(e));\n  //         }\n  //     }\n\n  //     asyncUseEffect();\n  // }, [messages])\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"main\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"story-page bg-color-blue-1\",\n      children: renderPage()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 351,\n    columnNumber: 9\n  }, this);\n}\n_s(Storypage, \"R4ktIQ9LcSmGsC8KJHQ0c9uvy+4=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n_c = Storypage;\nexport default Storypage;\nvar _c;\n$RefreshReg$(_c, \"Storypage\");","map":{"version":3,"names":["StoryImg","DecisionImg","ConversationImg","ConversationAvator","AudioIcon","AudioCurrentIcon","Dinasour","useDispatch","useSelector","axios","conversationRouter","storyRouter","storyActions","useEffect","useState","jsxDEV","_jsxDEV","Fragment","_Fragment","Storypage","_s","dispatch","scriptplay_id","state","story","atagonist","pages","nextTask","storyPlayData","selectedChoice","setSelectedChoice","setDecisionChoice","n","messages","setMessages","userMsg","setUserMsg","continueStory","post","script_name","task","prompt","getStoryPrompt","order","summary","then","resp","addStoryPlayData","data","catch","e","alert","choice","role","content","first_sentence","character_name","res","i","type","renderPageStory","dataShown","children","className","src","alt","fileName","_jsxFileName","lineNumber","columnNumber","onClick","renderPageDecision","question","option_1","option_2","option_3","renderPageConversation","length","value","onChange","target","chat","renderPage","newMessages","push","console","log","username","character_description","_c","$RefreshReg$"],"sources":["/Users/yhx67/Projects/ZH/erisedstory-speech-therapy/frontend/src/pages/Stroypage.jsx"],"sourcesContent":["import \"../assets/css/storypage.css\";\nimport StoryImg from \"../assets/imgs/home_bg.png\";\nimport DecisionImg from \"../assets/imgs/sample_fear.png\";\nimport ConversationImg from \"../assets/imgs/conversation.jpg\";\nimport ConversationAvator from \"../assets/imgs/con-bot.png\";\nimport AudioIcon from \"../assets/icons/audio-fill.svg\";\nimport AudioCurrentIcon from \"../assets/icons/audio.svg\";\n\nimport Dinasour from \"../assets/icons/dinasour.png\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport axios from \"axios\";\nimport { conversationRouter, storyRouter } from \"../config/routeConfig\";\nimport { storyActions } from \"../redux/StorySlice\";\nimport { useEffect, useState } from \"react\";\n\n\nfunction Storypage() {\n    const dispatch = useDispatch();\n    // const navigate = useNavigate();\n\n\n    // states\n    const scriptplay_id = useSelector((state) => state.story.scriptplay_id);\n    const story = useSelector((state) => state.story.story);\n    const atagonist = useSelector((state) => state.story.atagonist);\n    const pages = useSelector((state) => state.story.pages);\n    const nextTask = useSelector((state) => state.story.nextTask);\n    const storyPlayData = useSelector((state) => state.story.storyPlayData);\n    // the page that is currently showing\n    // const [currentPage, setCurrentPage] = useState(0);\n    const [selectedChoice, setSelectedChoice] = useState(-1);\n    const setDecisionChoice = (n) => {\n        // add logic here to prevent following code if it is history page\n\n        setSelectedChoice(n);\n    }\n    const [messages, setMessages] = useState([]);\n    const [userMsg, setUserMsg] = useState(\"\");\n\n\n    /* \n    nextTask: \n        ASK_STORY: ask for a story description\n        ASK_DECISION_MAKING: ask for decision making and three options\n        ASK_CONVERSATION: ask for character\n        CONTINUE_DECISION_MAKING: ask for story description after options\n        END_CONVERSATION: ask for story description after conversation\n    */\n\n    const continueStory = () => {\n        // console.log(nextTask);\n        // 1.\n        if(nextTask === \"ASK_STORY\"){\n            axios.post(storyRouter, {\n                script_name: story,\n                task: nextTask,\n                prompt: getStoryPrompt(),\n                order:pages + 1,\n                scriptplay_id: scriptplay_id,\n                summary:\"N/A\",\n            })\n            .then((resp) => {\n                // You can change next task to conversation/decision/story here\n                // dispatch(storyActions.addStoryPlayData({data:resp.data, nextTask:\"ASK_DECISION_MAKING\"}));\n                dispatch(storyActions.addStoryPlayData({data:resp.data, nextTask:\"ASK_CONVERSATION\"}));\n            })\n            .catch((e) => alert(e));\n        // 2.\n        }else if(nextTask === \"ASK_DECISION_MAKING\"){\n            axios.post(storyRouter, {\n                script_name: story,\n                task: nextTask,\n                prompt: getStoryPrompt(),\n                order:pages + 1,\n                scriptplay_id: scriptplay_id,\n                summary:\"N/A\",\n            })\n            .then((resp) => {\n                dispatch(storyActions.addStoryPlayData({data:resp.data, nextTask:\"CONTINUE_DECISION_MAKING\"}));\n            })\n            .catch((e) => alert(e));\n        // 3.\n        }else if(nextTask === \"CONTINUE_DECISION_MAKING\"){\n            // check if choice is maked first\n            if(selectedChoice === -1){\n                alert(\"Let's make a choice first!\")\n                return\n            }\n            // send request\n            axios.post(storyRouter, {\n                script_name: story,\n                task: nextTask,\n                prompt: getStoryPrompt(),\n                order:pages + 1,\n                scriptplay_id: scriptplay_id,\n                summary:\"N/A\",\n                choice: storyPlayData[pages-1][`option_${selectedChoice}`],\n            })\n            .then((resp) => {\n                setSelectedChoice(-1);\n                // You can change next task to conversation/decision/story here\n                dispatch(storyActions.addStoryPlayData({data:resp.data, nextTask:\"ASK_CONVERSATION\"}));\n            })\n            .catch((e) => alert(e));\n        // 4.\n        }else if(nextTask === \"ASK_CONVERSATION\"){\n            axios.post(storyRouter, {\n                script_name: story,\n                task: nextTask,\n                prompt: getStoryPrompt(),\n                order:pages + 1,\n                scriptplay_id: scriptplay_id,\n                summary:\"N/A\",\n            })\n            .then((resp) => {\n                dispatch(storyActions.addStoryPlayData({data:resp.data, nextTask:\"END_CONVERSATION\"}));\n                setMessages([{role:\"assistant\", content:resp.data.first_sentence}]);\n            })\n            .catch((e) => alert(e));\n        // 5.\n        }else if(nextTask === \"END_CONVERSATION\"){\n            axios.post(storyRouter, {\n                script_name: story,\n                task: nextTask,\n                prompt: getStoryPrompt(),\n                order:pages + 1,\n                scriptplay_id: scriptplay_id,\n                summary:\"N/A\",\n                messages: messages,\n                character_name: atagonist,\n            })\n            .then((resp) => {\n                // clean messages\n                setMessages([]);\n                dispatch(storyActions.addStoryPlayData({data:resp.data, nextTask:\"ASK_DECISION_MAKING\"}));\n            })\n            .catch((e) => alert(e));\n        }\n    }\n\n    // combine all the data into a story prompt\n    const getStoryPrompt = () => {\n        let res = \"\";\n        for(let i=0; i<pages; i++){\n            if(storyPlayData[i].type === \"story-description\"){\n                res += storyPlayData[i].story;\n            }\n        }\n        return res;\n    }\n\n\n\n    // 1.if show story\n    const renderPageStory = (dataShown) => {\n        /* \n        data format:{\n          \"story\": \"In the enchanting world of magic, you step into the shoes of Harry Potter, the Boy Who Lived. Born on July 31, 1980, he hails from the non-magical Dursley family but is destined for greatness. An orphan raised by his cruel aunt and uncle, Harry discovered his extraordinary wizarding abilities on his 11th birthday when he received an acceptance letter from Hogwarts School of Witchcraft and Wizardry. With a lightning bolt scar on his forehead, he survived the dark wizard, Lord Voldemort, as a baby. As you embark on your journey, you'll learn about spells, potions, and the profound destiny that awaits you at Hogwarts. \",\n          \"type\": \"story-description\",\n          \"order\": 1,\n          \"timestamp\": \"2024-02-24T20:52:59.070248\"\n        }\n        */\n        return (\n            <>\n                <div className=\"story-page-left story-page-left-1\">\n                    <div className=\"story-page-img img-box boder-1\">\n                        <img src={StoryImg} alt=\"a sample img\" className=\"story-page-img box-img\"></img> \n                    </div>\n                </div>\n\n                <div className=\"story-page-right story-page-right-1\">\n                    <div className=\"right-type1-body boder-1 bg-color-pink-1\">\n                        <img className=\"story-decoration-img\" src={Dinasour} alt=\"a cute dinasour\"></img>\n                        <div className=\"font-size-2-5 right-type1-title font-bold\">Story</div>\n                        <div className=\"font-size-2 right-type1-content scrobar-1\">{dataShown.story}</div>\n                    </div>\n\n                    <div className=\"page-right-btns\">\n                        <button className=\"btn-steps font-size-2\" onClick={continueStory}>Next</button>\n                    </div>\n                </div>\n            </>\n        )  \n    }\n\n    // 2.if show decision making\n    const renderPageDecision = (dataShown) => {\n        /* \n        data format:{\n          question:\n          option_1:\n          option_2:\n          option_3: \n          \"type\": \"decision-making\",\n          \"order\": 1,\n          \"timestamp\": \"2024-02-24T20:52:59.070248\"\n\n          //below only shows in history data\n          choice: <OPTION CONTENT>\n        }\n        */\n        return (\n            <>\n                <div className=\"story-page-left story-page-left-2\">\n                    <div className=\"story-page-img img-box boder-1\">\n                        <img src={DecisionImg} alt=\"a sample img\" className=\"story-page-img box-img\"></img> \n                    </div>\n                </div>\n\n                <div className=\"story-page-right story-page-right-2\">\n                    <div className=\"right-type2-body boder-1 bg-color-green-1\">\n                        <div className=\"right-type2-qs font-size-2-5 font-bold\">Decision Making</div>\n                        <div className=\"right-type2-question font-size-2 scrobar-1\">{dataShown.question}</div>\n\n                        <div className=\"right-type2-choices scrobar-1\">\n                            <button \n                                className={`btn-choices font-size-2 ${selectedChoice === 1 ? \"btn-choices-selected\":\"\"}`} \n                                onClick={() => setDecisionChoice(1)}\n                            >{dataShown.option_1}</button>\n                            <button \n                                className={`btn-choices font-size-2 ${selectedChoice === 2 ? \"btn-choices-selected\":\"\"}`} \n                                onClick={() => setDecisionChoice(2)}\n                            >{dataShown.option_2}</button>\n                            <button \n                                className={`btn-choices font-size-2 ${selectedChoice === 3 ? \"btn-choices-selected\":\"\"}`} \n                                onClick={() => setDecisionChoice(3)}\n                            >{dataShown.option_3}</button>\n                        </div>\n                    </div>\n\n                    <div className=\"page-right-btns\">\n                        <button className=\"btn-steps font-size-1-5\" onClick={continueStory}>Next</button>\n                    </div>     \n                </div>\n            </>\n        )\n    }\n\n    // 3.if show conversation\n    const renderPageConversation = (dataShown) => {\n        /* \n        data format:{\n          character_name:\n          character_description:\n          first_sentence: \n          \"type\": \"conversation\",\n          \"order\": 1,\n          \"timestamp\": \"2024-02-24T20:52:59.070248\",\n\n          //below only shows in history data\n          messages [{role:assistant, content:\"\"},{role:user, content:\"\"]\n        }\n        */\n        return (\n            <>\n                <div className=\"story-page-left story-page-left-3\">\n                    <div className=\"story-page-img img-box boder-1\">\n                        <img src={ConversationImg} alt=\"a sample img\" className=\"story-page-img box-img\"></img> \n                    </div>\n\n                    <div className=\"left-type-3-msg\">\n                        <div className=\"type-3-msg-avatar \">\n                            <img src={ConversationAvator} alt=\"a chat bot\"></img>\n                            <div className=\"ch-name font-size-1\">{dataShown.character_name}</div>\n                        </div>\n                        <div className=\"type-3-msg-body bubble bubble-bottom-left\">\n                           <p className=\"scrobar-1\">{messages.length > 0 ? messages[messages.length - 1].content: \"\"}</p>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"story-page-right story-page-right-3\">\n                    <div className=\"right-type3-body boder-1 bg-color-blue-2\">\n                        <div className=\"font-size-2-5 right-type1-title font-bold\">Talk</div>\n                        {/* <div className=\"font-size-2 right-type1-content scrobar-1\">Lorem ipsum dolor sit, amet consectetur adipisicing elit. Doloribus pariatur aut quo, laudantium ratione hic veniam asperiores deserunt animi iusto nihil perspiciatis non ipsam, dolorem doloremque quos vero. Eos, explicabo.</div> */}\n                        <input className=\"font-size-2 right-type1-content scrobar-1\" type=\"text\" value={userMsg} onChange={(e) => setUserMsg(e.target.value)}></input>\n                        <div className=\"right-type3-audio\">\n                            <button onClick={chat}>\n                                <img src={AudioIcon} alt=\"click button for audio input\"></img>\n                            </button>\n                        </div>\n                    </div>\n\n                    <div className=\"page-right-btns\">\n                        <button className=\"btn-steps font-size-2\" onClick={continueStory}>Next</button>\n                    </div>\n                </div>\n            </>\n        )  \n    }\n\n    const renderPage = () => {\n        let dataShown = storyPlayData[storyPlayData.length -1]; // replace last page with currentPage\n        if(dataShown.type === \"story-description\"){\n            return renderPageStory(dataShown);\n        }else if(dataShown.type === \"decision-making\"){\n            return renderPageDecision(dataShown);\n        }else if(dataShown.type === \"conversation\"){\n            return renderPageConversation(dataShown);\n        }\n    }\n\n    \n    // user input and send to chat\n    const chat = () =>{\n        let newMessages = messages;\n        newMessages.push({role:\"user\", content:userMsg});\n        console.log(newMessages);\n\n        axios.post(conversationRouter, {\n            username: atagonist,\n            prompt: getStoryPrompt(),\n            character_name:storyPlayData[pages -1].character_name,\n            character_description:storyPlayData[pages -1].character_description,\n            messages: newMessages,\n        })\n        .then((resp) => {\n            // console.log(resp.data);\n            setUserMsg(\"\");\n            setMessages([...messages, {role:\"assistant\", content:resp.data}])\n        })\n        .catch((e) => alert(e));\n        // setMessages([...messages, {role:\"user\", userMsg}])   \n    }\n    // useEffect(() => {\n    //     const asyncUseEffect = () => {\n    //         console.log(12)\n    //         if(messages.length > 0 && messages[messages.length -1].role === \"user\"){\n    //             axios.post(conversationRouter, {\n    //                 chat_background: storyPlayData[pages -1].chat_background,\n    //                 prompt: getStoryPrompt(),\n    //                 character_name:storyPlayData[pages -1].character_name,\n    //                 character_description:storyPlayData[pages -1].character_description,\n    //                 messages: messages,\n    //             })\n    //             .then((resp) => {\n    //                 console.log(resp.data);\n    //                 setUserMsg(\"\");\n    //             })\n    //             .catch((e) => alert(e));\n    //         }\n    //     }\n\n    //     asyncUseEffect();\n    // }, [messages])\n\n\n\n    return (  \n        <div className=\"main\">\n            <div className=\"story-page bg-color-blue-1\">\n                {renderPage()}\n            </div>\n\n\n        </div>\n    );\n}\n\nexport default Storypage;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}